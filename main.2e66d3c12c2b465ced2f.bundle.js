(()=>{"use strict";var e,t={458:(e,t,i)=>{var s=i(440),r=i.n(s);class o extends Phaser.Scene{constructor(){super("init")}preload(){this.load.image("background","./assets/images/backgrounds/background.png")}create(){this.scene.start("preload")}}class n extends Phaser.Scene{constructor(){super("preload")}preload(){this.cameras.main.setBackgroundColor(16777215),this.add.image(0,0,"background").setOrigin(0),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/images/gems/pack.json","preload"),this.load.image("ground","./assets/images/grounds/ground.png"),this.load.image("selection","./assets/images/selection-frames/selection-frame.png"),this.load.image("particle","./assets/images/particles/particle-1.png"),this.load.image("smoke-particle","./assets/images/particles/particle-2.png"),this.load.image("golden-particle","./assets/images/particles/particle-3.png"),this.load.image("glass-particle","./assets/images/particles/particle-4.png"),this.load.image("leaf-particle","./assets/images/particles/particle-5.png"),this.load.image("progress-frame","./assets/images/progress-info/progress-frame.png"),this.load.image("progress-body","./assets/images/progress-info/progress-body.png"),this.load.image("progress-head","./assets/images/progress-info/progress-head.png"),this.load.image("progress-tail","./assets/images/progress-info/progress-tail.png"),this.load.image("progress-milestone","./assets/images/progress-info/progress-milestone.png"),this.load.image("progress-score","./assets/images/progress-info/progress-score.png"),this.load.image("progress-achievement","./assets/images/progress-info/progress-achievement.png")}create(){this.scene.start("gameplay")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const h={SCORE:0,HIGH_SCORE:0,GRID_WIDTH:8,GRID_HEIGHT:8,TILE_WIDTH:64,TILE_HEIGHT:64,TILE_TYPES:["gem-1","gem-2","gem-3","gem-4","gem-5","gem-6","gem-7"],MATCH_TYPES:["0","4","5","5S"],MILESTONES:[100,2e3,5e3,1e4,15e3,2e4,3e4,5e4,75e3,1e5]},a=e=>Math.round(20*(e+1)+e*h.TILE_WIDTH+h.TILE_WIDTH/2),l=e=>Math.round((e-h.TILE_WIDTH/2-20)/(20+h.TILE_WIDTH)),d=e=>Math.round(20*(e+1)+e*h.TILE_HEIGHT+h.TILE_HEIGHT/2),c=e=>Math.round((e-h.TILE_HEIGHT/2-20)/(20+h.TILE_HEIGHT)),g=(e,t)=>e.filter((e=>t.includes(e))),p=(e,t)=>Array.from(new Set([...e,...t])),m=e=>{let t=e.length;for(;0!=t;){let i=Math.floor(Math.random()*t);t--,[e[t],e[i]]=[e[i],e[t]]}return e};class u extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.setInteractive(),this.scene.add.existing(this),this.explosionType=h.MATCH_TYPES[0]}setExplosionType(e){this.explosionType=e}getExplostionType(){return this.explosionType}addGlow(e){var t;const i=null===(t=this.postFX)||void 0===t?void 0:t.addGlow(e,0,0);this.scene.tweens.add({targets:i,outerStrength:8,duration:500,yoyo:!0,loop:-1,ease:Phaser.Math.Easing.Sine.InOut}),this.scene.tweens.add({targets:this,alpha:.8,duration:500,yoyo:!0,loop:-1,ease:Phaser.Math.Easing.Sine.InOut})}doDestroyEffect(e,t,i){return this.isTweening()?Promise.resolve():(this.scene.events.emit("tiledestroyed",25),new Promise(t&&i?s=>{this.addBurstingParticle(),this.scene.add.tween({targets:this,x:t,y:i,scale:0,duration:100,ease:e=>Phaser.Math.Easing.Cubic.In(e),repeat:0,onComplete:()=>{this.active&&this.destroy(),e(),s()}})}:t=>{this.addBurstingParticle(),this.scene.add.tween({targets:this,scale:0,duration:100,ease:e=>Phaser.Math.Easing.Cubic.In(e),repeat:0,onComplete:()=>{this.active&&(this.setVisible(!1),this.destroy()),e(),t()}})}))}addBurstingParticle(){const e=this.scene.add.particles(this.x,this.y,"particle",{lifespan:200,speed:{min:100,max:300},scale:{start:1,end:1},rotate:{min:0,max:360},blendMode:"ADD",emitting:!1});this.parentContainer.add(e),e.explode(20,0,0)}isTweening(){const e=this.scene.tweens.getTweensOf(this);for(let t=0;t<e.length;t++)if(e[t].isActive())return!0;return!1}}class f{constructor(e){this.scene=e}createTileId(e,t,i){return new u({scene:this.scene,x:t,y:i,texture:h.TILE_TYPES[e]})}createRandomTile(e,t){const i=h.TILE_TYPES[Phaser.Math.RND.between(0,h.TILE_TYPES.length-1)];return new u({scene:this.scene,x:e,y:t,texture:i})}}class T{constructor(e,t,i){this.tileList=e,this.mergedIntoTile=t,i?(this.type=i,this.mergedIntoTile.setExplosionType(this.type)):(this.type=this.calcMatchType(),this.mergedIntoTile.getExplostionType()==h.MATCH_TYPES[0]&&this.mergedIntoTile.setExplosionType(this.type))}getMatchType(){return this.type}getTileList(){return this.tileList}getMergedIntoTile(){return this.mergedIntoTile}calcMatchType(){for(let e=0;e<this.tileList.length;e++)if(this.tileList[e].getExplostionType()!=h.MATCH_TYPES[0])return h.MATCH_TYPES[0];if(this.tileList.length>=5){let e=[0,0,0,0];for(let t=0;t<this.tileList.length;t++)this.tileList[t].x-this.mergedIntoTile.x>0?e[3]=1:this.tileList[t].x-this.mergedIntoTile.x<0?e[2]=1:this.tileList[t].y-this.mergedIntoTile.y>0?e[1]=1:this.tileList[t].y-this.mergedIntoTile.y<0&&(e[0]=1);const t=e[0]+e[1]+e[2]+e[3];return 4==t||3==t?h.MATCH_TYPES[3]:2==t?e[0]+e[1]!=1?h.MATCH_TYPES[2]:h.MATCH_TYPES[3]:h.MATCH_TYPES[2]}return this.tileList.length>=4?h.MATCH_TYPES[1]:(this.tileList.length,h.MATCH_TYPES[0])}}var y=function(e,t,i,s){return new(i||(i=Promise))((function(r,o){function n(e){try{a(s.next(e))}catch(e){o(e)}}function h(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,h)}a((s=s.apply(e,t||[])).next())}))};class S extends Phaser.GameObjects.Container{constructor(e,t,i){super(e,t,i),this.onSwapping=!1,this.emptiesInColumn=[],this.secondSwapping=!1,this.idlingTime=0,e.add.existing(this),this.scene.input.on("gameobjectdown",this.click,this),this.scene.input.on("gameobjectover",this.over,this),this.scene.input.on("gameobjectout",this.out,this),this.tileFactory=new f(e),this.tileGrid=[],this.haveTile=[],this.tilePosition=[];for(let e=0;e<h.GRID_HEIGHT;e++){this.tileGrid[e]=[],this.haveTile[e]=[],this.tilePosition[e]=[];for(let t=0;t<h.GRID_WIDTH;t++){const i=this.scene.add.image(a(t),d(e),"ground");this.add(i)}}for(let e=0;e<h.GRID_HEIGHT;e++)for(let t=0;t<h.GRID_WIDTH;t++)this.tilePosition[e][t]={x:a(t),y:d(e)},this.tileGrid[e][t]=this.tileFactory.createRandomTile(a(t),d(e)),this.haveTile[e][t]=!0,this.add(this.tileGrid[e][t]);this.doRandomShuffle(),this.firstSelectionFrame=this.scene.add.image(0,0,"selection").setVisible(!1),this.secondSelectionFrame=this.scene.add.image(0,0,"selection").setVisible(!1),this.add(this.firstSelectionFrame),this.add(this.secondSelectionFrame),this.scene.add.tween({targets:this.firstSelectionFrame,scale:.9,yoyo:!0,duration:200,ease:Phaser.Math.Easing.Cubic.In,repeat:-1,persist:!0}),this.scene.add.tween({targets:this.secondSelectionFrame,scale:.9,yoyo:!0,duration:200,ease:Phaser.Math.Easing.Cubic.In,repeat:-1,persist:!0});for(let e=0;e<8;e++)this.emptiesInColumn.push(0)}finish(){for(let e=0;e<h.GRID_HEIGHT;e++)for(let t=0;t<h.GRID_WIDTH;t++)this.scene.tweens.killTweensOf(this.tileGrid[e][t]),this.tileGrid[e][t].setScale(1),this.scene.add.tween({targets:this.tileGrid[e][t],x:346,y:346,delay:20*(8*e+t),duration:500,onComplete:()=>{this.tileGrid[e][t].destroy(),this.haveTile[e][t]=!1}})}restart(){for(let e=0;e<h.GRID_HEIGHT;e++)for(let t=0;t<h.GRID_WIDTH;t++)this.tilePosition[e][t]={x:a(t),y:d(e)},this.tileGrid[e][t]=this.tileFactory.createRandomTile(a(t),d(e)),this.haveTile[e][t]=!0,this.add(this.tileGrid[e][t]);this.doRandomShuffle()}reset(){this.idlingTime=0,this.firstSelectionFrame.setVisible(!1),this.secondSelectionFrame.setVisible(!1);for(let e=0;e<this.tileGrid.length;e++)for(let t=0;t<this.tileGrid[e].length;t++)this.scene.tweens.killTweensOf(this.tileGrid[e][t]),this.tileGrid[e][t].setScale(1),this.tileGrid[e][t].setX(this.tilePosition[e][t].x),this.tileGrid[e][t].setY(this.tilePosition[e][t].y)}click(e,t){return y(this,void 0,void 0,(function*(){if(!this.onSwapping)if(this.reset(),this.firstSelectedTile)if(this.firstSelectedTile!=t){this.firstSelectionFrame.setVisible(!1),this.secondSelectedTile=t;const e=Math.floor(Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x)/h.TILE_WIDTH),i=Math.floor(Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y)/h.TILE_HEIGHT);1===e&&0===i||0===e&&1===i?(this.onSwapping=!0,yield this.swapTiles(),this.firstSelectedTile=void 0):(this.firstSelectionFrame.setVisible(!0),this.firstSelectionFrame.setPosition(t.x,t.y),this.firstSelectedTile=t)}else this.firstSelectionFrame.setVisible(!0),this.firstSelectionFrame.setPosition(t.x,t.y),this.firstSelectedTile=t;else this.firstSelectionFrame.setVisible(!0),this.firstSelectionFrame.setPosition(t.x,t.y),this.firstSelectedTile=t}))}over(e,t){this.onSwapping||t!=this.firstSelectedTile&&this.scene.add.tween({targets:t,scale:1.2,duration:100,repeat:0})}out(e,t){this.onSwapping||this.scene.add.tween({targets:t,scale:1,duration:100,repeat:0})}doSwapTiles(){return y(this,void 0,void 0,(function*(){let e=[];e.push(new Promise((e=>{var t,i;this.scene.add.tween({targets:this.firstSelectedTile,x:null===(t=this.secondSelectedTile)||void 0===t?void 0:t.x,y:null===(i=this.secondSelectedTile)||void 0===i?void 0:i.y,duration:100,repeat:0,yoyo:!1,onComplete:()=>{e()}})}))),e.push(new Promise((e=>{var t,i;this.scene.add.tween({targets:this.secondSelectedTile,x:null===(t=this.firstSelectedTile)||void 0===t?void 0:t.x,y:null===(i=this.firstSelectedTile)||void 0===i?void 0:i.y,duration:100,repeat:0,yoyo:!1,onComplete:()=>{e()}})}))),yield Promise.all(e)}))}swapTiles(){return y(this,void 0,void 0,(function*(){if(this.firstSelectedTile&&this.secondSelectedTile){const e={x:this.firstSelectedTile.x,y:this.firstSelectedTile.y},t={x:this.secondSelectedTile.x,y:this.secondSelectedTile.y};this.tileGrid[c(e.y)][l(e.x)]=this.secondSelectedTile,this.tileGrid[c(t.y)][l(t.x)]=this.firstSelectedTile,yield this.doSwapTiles(),this.secondSwapping?this.secondSwapping=!1:yield this.checkMatches(),this.firstSelectedTile=this.tileGrid[c(e.y)][l(e.x)],this.secondSelectedTile=this.tileGrid[c(t.y)][l(t.x)]}else this.secondSwapping=!1}))}checkMatches(){return y(this,void 0,void 0,(function*(){this.reset();const e=this.getMatches(this.tileGrid);e.length>0?(yield this.removeTile(e),yield this.refillTile(),yield this.tileUp(),yield this.checkMatches()):(this.secondSwapping=!0,yield this.swapTiles(),this.tileUp(),this.onSwapping=!1)}))}refillTile(){return y(this,void 0,void 0,(function*(){this.idlingTime=0;let e=[];for(let e=0;e<8;e++)this.emptiesInColumn[e]=0;for(let t=this.tileGrid.length-1;t>=0;t--)for(let i=0;i<this.tileGrid[t].length;i++)this.haveTile[t][i]?this.emptiesInColumn[i]>0&&(e.push(this.moveWithTweenTo(this.tileGrid[t][i],t+this.emptiesInColumn[i],i)),this.tileGrid[t+this.emptiesInColumn[i]][i]=this.tileGrid[t][i],this.haveTile[t+this.emptiesInColumn[i]][i]=!0,this.haveTile[t][i]=!1):this.emptiesInColumn[i]+=1;for(let t=this.tileGrid.length-1;t>=0;t--)for(let i=0;i<this.tileGrid[t].length;i++)if(!this.haveTile[t][i]&&this.emptiesInColumn[i]>0){const s=this.tileFactory.createRandomTile(a(i),d(t-this.emptiesInColumn[i]));this.add(s),e.push(this.moveWithTweenTo(s,t,i)),this.tileGrid[t][i]=s,this.haveTile[t][i]=!0}yield Promise.all(e)}))}tileUp(){return y(this,void 0,void 0,(function*(){this.idlingTime=0,this.firstSelectedTile=void 0,this.secondSelectedTile=void 0}))}moveWithTweenTo(e,t,i){return new Promise((s=>{this.scene.add.tween({targets:e,y:d(t),ease:e=>Phaser.Math.Easing.Cubic.In(e),duration:1e3*this.emptiesInColumn[i]/8,repeat:0,yoyo:!1,onComplete:()=>{s()}})}))}removeTile(e){return y(this,void 0,void 0,(function*(){let t=[];for(let i=0;i<e.length;i++)switch(e[i].getMatchType()){case h.MATCH_TYPES[0]:e[i].getTileList().forEach((e=>{t.push(e.doDestroyEffect((()=>{this.haveTile[c(e.y)][l(e.x)]=!1}))),e.getExplostionType()!=h.MATCH_TYPES[0]&&this.doExplosion(t,e)}));break;case h.MATCH_TYPES[1]:{const s=e[i].getMergedIntoTile();e[i].getTileList().forEach((e=>{const i=c(e.y),r=l(e.x);e!=s?t.push(e.doDestroyEffect((()=>{this.haveTile[i][r]=!1}),s.x,s.y)):s.addGlow(15720891)}));break}case h.MATCH_TYPES[2]:{const s=e[i].getMergedIntoTile();e[i].getTileList().forEach((e=>{const i=c(e.y),r=l(e.x);e!=s?t.push(e.doDestroyEffect((()=>{this.haveTile[i][r]=!1}),s.x,s.y)):s.addGlow(15720891)}));break}case h.MATCH_TYPES[3]:{const s=e[i].getMergedIntoTile();e[i].getTileList().forEach((e=>{const i=c(e.y),r=l(e.x);e!=s?t.push(e.doDestroyEffect((()=>{this.haveTile[i][r]=!1}),s.x,s.y)):s.addGlow(15720891)}));break}}yield Promise.all(t)}))}doRandomShuffle(){this.idlingTime=0;let e=64,t=[];for(let e=0;e<this.tileGrid.length;e++)for(let i=0;i<this.tileGrid[0].length;i++)t.push(this.tileGrid[e][i]);t=m(t);const i=new Phaser.Geom.Circle(346,346,64);Phaser.Actions.PlaceOnCircle(t,i),this.scene.tweens.add({targets:i,radius:228,ease:"Quintic.easeInOut",duration:2e3,onUpdate:function(){Phaser.Actions.RotateAroundDistance(t,{x:346,y:346},.1,i.radius)},onComplete:()=>{for(let i=0;i<this.tileGrid.length;i++)for(let s=0;s<this.tileGrid[0].length;s++)this.tileGrid[i][s]=t[i*this.tileGrid.length+s],this.scene.add.tween({targets:t[i*this.tileGrid.length+s],x:this.tilePosition[i][s].x,y:this.tilePosition[i][s].y,duration:500,onComplete:()=>{e--,0==e&&this.checkMatches()}})}})}getMatches(e){this.idlingTime=0;const t=[],i=[];let s=[],r=[];for(let t=0;t<e.length;t++){r=[];for(let o=0;o<e[t].length;o++)o<e[t].length-2&&e[t][o]&&e[t][o+1]&&e[t][o+2]&&e[t][o].texture.key===e[t][o+1].texture.key&&e[t][o+1].texture.key===e[t][o+2].texture.key&&(r.length>0&&-1==r.indexOf(e[t][o])&&(i.push(r),s.push(!1),r=[]),-1==r.indexOf(e[t][o])&&r.push(e[t][o]),-1==r.indexOf(e[t][o+1])&&r.push(e[t][o+1]),-1==r.indexOf(e[t][o+2])&&r.push(e[t][o+2]));r.length>0&&(i.push(r),s.push(!1))}for(let t=0;t<e[0].length;t++){r=[];for(let o=0;o<e.length;o++)o<e.length-2&&e[o][t]&&e[o+1][t]&&e[o+2][t]&&e[o][t].texture.key===e[o+1][t].texture.key&&e[o+1][t].texture.key===e[o+2][t].texture.key&&(r.length>0&&-1==r.indexOf(e[o][t])&&(i.push(r),s.push(!1),r=[]),-1==r.indexOf(e[o][t])&&r.push(e[o][t]),-1==r.indexOf(e[o+1][t])&&r.push(e[o+1][t]),-1==r.indexOf(e[o+2][t])&&r.push(e[o+2][t]));r.length>0&&(i.push(r),s.push(!1))}for(let e=0;e<i.length-1;e++)if(!s[e])for(let r=e+1;r<i.length;r++){if(s[r])continue;const o=g(i[e],i[r]),n=p(i[e],i[r]);if(o.length>0){s[e]=!0,s[r]=!0,this.firstSelectedTile&&n.indexOf(this.firstSelectedTile)>-1?t.push(new T(n,this.firstSelectedTile)):this.secondSelectedTile&&n.indexOf(this.secondSelectedTile)>-1?t.push(new T(n,this.secondSelectedTile)):t.push(new T(n,o[0]));break}}for(let e=0;e<i.length;e++)if(!s[e])if(this.firstSelectedTile&&i[e].indexOf(this.firstSelectedTile)>-1)t.push(new T(i[e],this.firstSelectedTile));else if(this.secondSelectedTile&&i[e].indexOf(this.secondSelectedTile)>-1)t.push(new T(i[e],this.secondSelectedTile));else{const s=i[e].length;t.push(new T(i[e],i[e][Math.floor(s/2)]))}return t}displayHint(){let e=!1;for(let t=0;t<this.tileGrid.length;t++){for(let i=0;i<this.tileGrid[0].length;i++){if(this.doHintSwap(t,i,t+1,i)){this.firstSelectionFrame.setPosition(a(i),d(t)),this.secondSelectionFrame.setPosition(a(i),d(t+1)),this.firstSelectionFrame.setVisible(!0),this.secondSelectionFrame.setVisible(!0),e=!0;break}if(this.doHintSwap(t,i,t-1,i)){this.firstSelectionFrame.setPosition(a(i),d(t)),this.secondSelectionFrame.setPosition(a(i),d(t-1)),this.firstSelectionFrame.setVisible(!0),this.secondSelectionFrame.setVisible(!0),e=!0;break}if(this.doHintSwap(t,i,t,i+1)){this.firstSelectionFrame.setPosition(a(i),d(t)),this.secondSelectionFrame.setPosition(a(i+1),d(t)),this.firstSelectionFrame.setVisible(!0),this.secondSelectionFrame.setVisible(!0),e=!0;break}if(this.doHintSwap(t,i,t,i-1)){this.firstSelectionFrame.setPosition(a(i),d(t)),this.secondSelectionFrame.setPosition(a(i-1),d(t)),this.firstSelectionFrame.setVisible(!0),this.secondSelectionFrame.setVisible(!0),e=!0;break}}if(e)break}}doHintSwap(e,t,i,s){if(i<0||i>=this.tileGrid.length)return!1;if(s<0||s>=this.tileGrid[0].length)return!1;let r=this.tileGrid[e][t];this.tileGrid[e][t]=this.tileGrid[i][s],this.tileGrid[i][s]=r;let o=this.haveMatch();return r=this.tileGrid[i][s],this.tileGrid[i][s]=this.tileGrid[e][t],this.tileGrid[e][t]=r,o}haveMatch(){for(let e=0;e<this.tileGrid.length;e++)for(let t=0;t<this.tileGrid[e].length;t++)if(t<this.tileGrid[e].length-2&&this.tileGrid[e][t]&&this.tileGrid[e][t+1]&&this.tileGrid[e][t+2]&&this.tileGrid[e][t].texture.key===this.tileGrid[e][t+1].texture.key&&this.tileGrid[e][t+1].texture.key===this.tileGrid[e][t+2].texture.key)return!0;for(let e=0;e<this.tileGrid[0].length;e++)for(let t=0;t<this.tileGrid.length;t++)if(t<this.tileGrid.length-2&&this.tileGrid[t][e]&&this.tileGrid[t+1][e]&&this.tileGrid[t+2][e]&&this.tileGrid[t][e].texture.key===this.tileGrid[t+1][e].texture.key&&this.tileGrid[t+1][e].texture.key===this.tileGrid[t+2][e].texture.key)return!0;return!1}doIdling(){for(let e=0;e<this.tileGrid.length;e++)for(let t=0;t<this.tileGrid[e].length;t++)this.scene.add.tween({targets:this.tileGrid[e][t],y:this.tileGrid[e][t].y-10,ease:Phaser.Math.Easing.Cubic.InOut,duration:400,delay:20*t,yoyo:!0,repeat:0,onComplete:()=>{this.scene.add.tween({targets:this.tileGrid[e][t],y:this.tileGrid[e][t].y+10,ease:Phaser.Math.Easing.Cubic.InOut,duration:400,delay:20*t,yoyo:!0,repeat:0,onComplete:()=>{this.idlingTime=0}})}})}update(e,t){this.idlingTime>5e3?(console.log("idling"),this.idlingTime=0,this.displayHint(),this.doIdling()):this.idlingTime+=t}doExplosion(e,t){this.idlingTime=0,t.getExplostionType()==h.MATCH_TYPES[1]?this.doMatchFourExplosion(e,t):this.doMatchFiveExplosion(e,t)}doMatchFourExplosion(e,t){this.idlingTime=0;const i=c(t.y),s=l(t.x);for(let t=i-1;t<=i+1;t++)for(let i=s-1;i<=s+1;i++)t>=0&&t<h.GRID_WIDTH&&i>=0&&i<h.GRID_WIDTH&&e.push(this.tileGrid[t][i].doDestroyEffect((()=>{this.haveTile[t][i]=!1})))}doMatchFiveExplosion(e,t){this.idlingTime=0;const i=c(t.y),s=l(t.x);if(t.getExplostionType()==h.MATCH_TYPES[2])for(let t=0;t<h.GRID_WIDTH;t++)e.push(this.tileGrid[i][t].doDestroyEffect((()=>{this.haveTile[i][t]=!1})));else if(t.getExplostionType()==h.MATCH_TYPES[3])for(let t=0;t<h.GRID_HEIGHT;t++)e.push(this.tileGrid[t][s].doDestroyEffect((()=>{this.haveTile[t][s]=!1})));else if(t.getExplostionType()==h.MATCH_TYPES[4]){let t=[];for(let e=0;e<64;e++)t.push(e);t=m(t);for(let i=0;i<10;i++){let s,r;s=Math.floor(t[i]/8),r=t[i]-8*s,e.push(this.tileGrid[s][r].doDestroyEffect((()=>{this.haveTile[s][r]=!1})))}}}}class v extends Phaser.GameObjects.Container{constructor(e,t,i){super(e,t,i),e.add.existing(this),this.currentScore=0,this.currentMilestoneId=0,this.initProgressBar(),this.initMilestoneBoard(),this.add(this.progressFrame),this.add(this.progressHead),this.add(this.progressTail),this.add(this.progressBody),this.add(this.progressScoreFrame),this.add(this.progressScore),this.add(this.milestoneBoard),this.add(this.milestoneWord),this.add(this.milestoneScore)}initProgressBar(){this.scene.events.on("tiledestroyed",(e=>{let t=!1;this.currentScore+e>=h.MILESTONES[this.currentMilestoneId]?this.currentScore!=h.MILESTONES[this.currentMilestoneId]&&(t=!0,this.currentScore=h.MILESTONES[this.currentMilestoneId]):this.currentScore+=e,this.scene.add.tween({targets:this.progressBody,scaleX:this.currentScore/h.MILESTONES[this.currentMilestoneId]*2.085,duration:200,onUpdate:()=>{this.progressTail.setX(15+this.progressBody.displayWidth),this.setDisplayProgressScore(this.currentScore)},onComplete:()=>{this.setDisplayProgressScore(this.currentScore),t&&this.scene.events.emit("milestoneachieved",this.currentMilestoneId)}})})),this.progressFrame=this.scene.add.image(0,125,"progress-frame").setOrigin(0),this.progressHead=this.scene.add.image(9,140,"progress-head").setOrigin(0),this.progressTail=this.scene.add.image(19,140,"progress-tail").setOrigin(0),this.progressBody=this.scene.add.image(16,140,"progress-body").setScale(0,1).setOrigin(0),this.progressScoreFrame=this.scene.add.image(100,220,"progress-score").setOrigin(0),this.progressScore=this.scene.add.text(120,230,String(this.currentScore),{fontFamily:"garamond",fontStyle:"bold",fontSize:64,color:"#efe1bb"}),this.setDisplayProgressScore(this.currentScore)}initMilestoneBoard(){this.milestoneBoard=this.scene.add.image(720,0,"progress-milestone").setOrigin(0),this.milestoneWord=this.scene.add.text(825,60,"MILESTONE",{fontFamily:"garamond",fontStyle:"bold",fontSize:64,color:"#efe1bb"}),this.milestoneScore=this.scene.add.text(0,160,String(h.MILESTONES[this.currentMilestoneId]),{fontFamily:"garamond",fontStyle:"bold",fontSize:100,color:"#efe1bb"}),this.setDisplayMilestoneScore()}finish(){this.scene.add.tween({targets:this.progressBody,scaleX:0,duration:1e3,onUpdate:()=>{this.progressTail.setX(15+this.progressBody.displayWidth),this.setDisplayProgressScore(Math.floor(this.scaleX/2.085*this.currentScore)),this.currentScore=Math.floor(this.scaleX/2.085*this.currentScore)},onComplete:()=>{this.currentScore=0,this.setDisplayProgressScore(this.currentScore)}})}restart(){this.currentMilestoneId+=1,this.currentMilestoneId>=10&&(this.currentMilestoneId=0),this.setDisplayMilestoneScore()}setDisplayProgressScore(e){this.progressScore.setText(String(e)),this.progressScore.setX(275-this.progressScore.displayWidth/2)}setDisplayMilestoneScore(){this.milestoneScore.setText(String(h.MILESTONES[this.currentMilestoneId])),this.milestoneScore.setX(1020-this.milestoneScore.displayWidth/2)}}class x extends Phaser.Scene{constructor(){super("gameplay")}create(){this.cameras.main.setBackgroundColor(16777215),this.add.image(0,0,"background").setOrigin(0),this.gameBoard=new S(this,60,260),this.progressInfo=new v(this,75,60).setScale(.5),this.add.zone(0,0,800,1e3).setOrigin(0),this.scene.launch("achievement")}update(e,t){this.gameBoard.update(e,t)}finish(){this.cameras.main.alpha=.5,this.gameBoard.finish(),this.progressInfo.finish()}restart(){this.cameras.main.alpha=1,this.gameBoard.restart(),this.progressInfo.restart()}}class I extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e)}update(e,t,i){if(this.velocityX<=0&&(this.velocityX=50,this.velocityY=50,this.accelerationX=Phaser.Math.RND.between(-2e3,2e3),this.accelerationY=Phaser.Math.RND.between(-2e3,2e3)),this.lifeCurrent<=0)return!(this.holdCurrent>0)||(this.holdCurrent-=e,this.holdCurrent<=0);if(this.delayCurrent>0)return this.delayCurrent-=e,!1;this.anims.update(0,e);var s=this.emitter,r=s.ops,o=1-this.lifeCurrent/this.life;if(this.lifeT=o,this.x=r.x.onUpdate(this,"x",o,this.x),this.y=r.y.onUpdate(this,"y",o,this.y),s.moveTo){var n=r.moveToX.onUpdate(this,"moveToX",o,s.moveToX),h=r.moveToY.onUpdate(this,"moveToY",o,s.moveToY),a=this.lifeCurrent/1e3;this.velocityX=(n-this.x)/a,this.velocityY=(h-this.y)/a}return this.computeVelocity(s,e,t,i,o),this.scaleX=r.scaleX.onUpdate(this,"scaleX",o,this.scaleX),r.scaleY.active?this.scaleY=r.scaleY.onUpdate(this,"scaleY",o,this.scaleY):this.scaleY=this.scaleX,this.angle=r.rotate.onUpdate(this,"rotate",o,this.angle),this.rotation=G(this.angle),s.getDeathZone(this)?(this.lifeCurrent=0,!0):(this.alpha=E(r.alpha.onUpdate(this,"alpha",o,this.alpha),0,1),r.color.active?this.tint=r.color.onUpdate(this,"color",o,this.tint):this.tint=r.tint.onUpdate(this,"tint",o,this.tint),this.lifeCurrent-=e,this.lifeCurrent<=0&&this.holdCurrent<=0)}}var E=function(e,t,i){return Math.max(t,Math.min(i,e))},G=function(e){return e/180*Math.PI};class M extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e)}update(e,t,i){if(this.velocityX>=0&&(this.velocityX=-50,this.velocityY=-50,this.accelerationX=Phaser.Math.RND.between(-2e3,2e3),this.accelerationY=Phaser.Math.RND.between(-2e3,2e3)),this.lifeCurrent<=0)return!(this.holdCurrent>0)||(this.holdCurrent-=e,this.holdCurrent<=0);if(this.delayCurrent>0)return this.delayCurrent-=e,!1;this.anims.update(0,e);var s=this.emitter,r=s.ops,o=1-this.lifeCurrent/this.life;if(this.lifeT=o,this.x=r.x.onUpdate(this,"x",o,this.x),this.y=r.y.onUpdate(this,"y",o,this.y),s.moveTo){var n=r.moveToX.onUpdate(this,"moveToX",o,s.moveToX),h=r.moveToY.onUpdate(this,"moveToY",o,s.moveToY),a=this.lifeCurrent/1e3;this.velocityX=(n-this.x)/a,this.velocityY=(h-this.y)/a}return this.computeVelocity(s,e,t,i,o),this.scaleX=r.scaleX.onUpdate(this,"scaleX",o,this.scaleX),r.scaleY.active?this.scaleY=r.scaleY.onUpdate(this,"scaleY",o,this.scaleY):this.scaleY=this.scaleX,this.angle=r.rotate.onUpdate(this,"rotate",o,this.angle),this.rotation=w(this.angle),s.getDeathZone(this)?(this.lifeCurrent=0,!0):(this.alpha=P(r.alpha.onUpdate(this,"alpha",o,this.alpha),0,1),r.color.active?this.tint=r.color.onUpdate(this,"color",o,this.tint):this.tint=r.tint.onUpdate(this,"tint",o,this.tint),this.lifeCurrent-=e,this.lifeCurrent<=0&&this.holdCurrent<=0)}}var P=function(e,t,i){return Math.max(t,Math.min(i,e))},w=function(e){return e/180*Math.PI};class C extends Phaser.Scene{constructor(){super("achievement")}preload(){}create(){this.onWaiting=!1,this.waitingTime=0,this.milestoneBoard=this.add.image(400,0,"progress-achievement").setScale(.6).setVisible(!1),this.achievementWord=this.add.text(270,0,"ACHIEVEMENT",{fontFamily:"garamond",fontStyle:"bold",fontSize:32,color:"#efe1bb"}).setVisible(!1),this.milestoneScore=this.add.text(0,0,"0",{fontFamily:"garamond",fontStyle:"bold",fontSize:80,color:"#efe1bb"}).setVisible(!1),this.scene.get("gameplay").events.on("milestoneachieved",(e=>{this.onWaiting=!0,this.doConfetti(500),this.dropMilestoneBoard(e);const t=this.scene.get("gameplay");t instanceof x&&t.finish()}))}update(e,t){this.onWaiting&&(this.waitingTime>3e3?(this.waitingTime=0,this.onWaiting=!1,this.add.tween({targets:this.milestoneBoard,y:1400,duration:1e3,ease:Phaser.Math.Easing.Back.InOut}),this.add.tween({targets:this.achievementWord,y:1400,duration:1e3,ease:Phaser.Math.Easing.Back.InOut}),this.add.tween({targets:this.milestoneScore,y:1400,duration:1e3,ease:Phaser.Math.Easing.Back.InOut,onComplete:()=>{this.milestoneBoard.setVisible(!1),this.achievementWord.setVisible(!1);const e=this.scene.get("gameplay");e instanceof x&&e.restart()}})):this.waitingTime+=t)}doConfetti(e){this.leftConfetti=this.add.particles(-50,900,"leaf-particle",{particleClass:I,delay:e,lifespan:2e3,angle:{min:-120,max:-30},speed:{min:1500,max:2500},rotate:{min:0,max:360},gravityY:3e3,gravityX:-3e3,scale:{start:.8,end:0},emitting:!1}),this.leftConfetti.explode(100),this.rightConfetti=this.add.particles(850,900,"leaf-particle",{particleClass:M,delay:e,lifespan:2e3,angle:{min:210,max:300},speed:{min:-2500,max:-1500},rotate:{min:0,max:360},gravityY:3e3,gravityX:3e3,scale:{start:.8,end:0},emitting:!1}),this.rightConfetti.explode(100)}dropMilestoneBoard(e){this.milestoneBoard.setVisible(!0),this.achievementWord.setVisible(!0),this.milestoneScore.setVisible(!0),this.milestoneScore.setText(String(h.MILESTONES[e])),this.milestoneScore.setX(400-this.milestoneScore.displayWidth/2),this.milestoneBoard.setY(-300),this.achievementWord.setY(-300),this.milestoneScore.setY(-300),this.add.tween({targets:this.milestoneBoard,y:600,duration:1e3,ease:Phaser.Math.Easing.Back.InOut}),this.add.tween({targets:this.achievementWord,y:400,duration:1e3,ease:Phaser.Math.Easing.Back.InOut}),this.add.tween({targets:this.milestoneScore,y:550,duration:1e3,ease:Phaser.Math.Easing.Back.InOut})}}const b={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"0.0.1",width:800,height:1e3,type:Phaser.AUTO,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},parent:"game",scene:[o,n,x,C],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0}};class H extends r().Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new H(b)}))}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var o=i[e]={exports:{}};return t[e].call(o.exports,o,o.exports,s),o.exports}s.m=t,e=[],s.O=(t,i,r,o)=>{if(!i){var n=1/0;for(d=0;d<e.length;d++){for(var[i,r,o]=e[d],h=!0,a=0;a<i.length;a++)(!1&o||n>=o)&&Object.keys(s.O).every((e=>s.O[e](i[a])))?i.splice(a--,1):(h=!1,o<n&&(n=o));if(h){e.splice(d--,1);var l=r();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,r,o]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,o,[n,h,a]=i,l=0;if(n.some((t=>0!==e[t]))){for(r in h)s.o(h,r)&&(s.m[r]=h[r]);if(a)var d=a(s)}for(t&&t(i);l<n.length;l++)o=n[l],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var r=s.O(void 0,[96],(()=>s(458)));r=s.O(r)})();